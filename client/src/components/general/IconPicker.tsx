// import { Loader2 } from "lucide-react";
import React, { useState, useEffect, useRef } from "react";
import {
  FaBeer, FaApple, FaAnchor, FaCoffee, FaCar, FaCat, FaDog, FaHome, FaSearch, FaInfoCircle,
  FaPlane, FaRocket, FaStar, FaTrashAlt, FaUser, FaBell, FaCloud, FaCogs, FaBriefcase, FaCamera,
  FaDesktop, FaEdit, FaHeart, FaMapMarker, FaPhone, FaShoppingCart, FaTv, FaVolumeUp,
  FaWifi, FaBicycle, FaGlobe, FaLaptop, FaUserAlt, FaSignInAlt, FaSignOutAlt, FaLayerGroup, FaLink,
  FaArrowAltCircleDown, FaArrowAltCircleUp, FaChevronCircleRight, FaChevronCircleLeft, FaDollarSign,
  FaEject, FaGift, FaFlag, FaGlasses, FaHandPaper, FaHeadphones, FaHdd, FaMusic, FaPowerOff, FaPhoneAlt,
  FaPlug, FaSatellite, FaShieldAlt, FaStop, FaSync, FaTachometerAlt, FaTrash, FaTree, FaUserPlus,
  FaUserCheck, FaWrench, FaTruck, FaKey, FaChartLine, FaHammer,
  FaPlayCircle, FaCog,
  FaCrosshairs,
  FaMap,
  FaDatabase,
  FaLock,
  FaUnlock,
  FaUndo,
  FaAdjust,
  FaAlignCenter,
  FaAlignJustify,
  FaAlignLeft,
  FaAlignRight,
  FaAllergies,
  FaAmbulance,
  FaAngleDoubleDown,
  FaAngleDoubleLeft,
  FaAngleDoubleRight,
  FaAngleDoubleUp,
  FaAngleDown,
  FaAngleLeft,
  FaAngleRight,
  FaAngleUp,
  FaAngry,
  FaAppleAlt,
  FaArchive,
  FaArchway,
  FaArrowCircleDown,
  FaArrowCircleLeft,
  FaArrowCircleRight,
  FaArrowCircleUp,
  FaArrowDown,
  FaArrowLeft,
  FaArrowRight,
  FaArrowUp,
  FaArrowsAlt,
  FaArrowsAltH,
  FaArrowsAltV,
  FaAssistiveListeningSystems,
  FaAsterisk,
  FaAt,
  FaAtom,
  FaAudioDescription,
  FaBackspace,
  FaBackward,
  FaBan,
  FaBandAid,
  FaBarcode,
  FaBars,
  FaBaseballBall,
  FaBasketballBall,
  FaBath,
  FaBatteryEmpty,
  FaBatteryFull,
  FaBatteryHalf,
  FaBatteryQuarter,
  FaBatteryThreeQuarters,
  FaBed,
  FaBinoculars,
  FaBirthdayCake,
  FaBlender,
  FaBold,
  FaBolt,
  FaBomb,
  FaBook,
  FaBookmark,
  FaBowlingBall,
  FaBox,
  FaBoxOpen,
  FaBoxes,
  FaBraille,
  FaBroadcastTower,
  FaBrush,
  FaBug,
  FaBuilding,
  FaBullhorn,
  FaBullseye,
  FaBurn,
  FaBus,
  FaBusinessTime,
  FaCalculator,
  FaCalendar,
  FaCalendarAlt,
  FaCalendarCheck,
  FaCalendarDay,
  FaCalendarMinus,
  FaCalendarPlus,
  FaCalendarTimes,
  FaCameraRetro,
  FaCampground,
  FaCarAlt,
  FaCaretDown,
  FaCaretLeft,
  FaCaretRight,
  FaCaretSquareDown,
  FaCaretSquareLeft,
  FaCaretSquareRight,
  FaCaretSquareUp,
  FaCaretUp,
  FaCartArrowDown,
  FaCartPlus,
  FaCertificate,
  FaChair,
  FaChalkboard,
  FaChalkboardTeacher,
  FaChargingStation,
  FaCheck,
  FaCheckCircle,
  FaCheckSquare,
  FaChevronCircleDown,
  FaChevronCircleUp,
  FaChild,
  FaChurch,
  FaCircle,
  FaCircleNotch,
  FaCity,
  FaClinicMedical,
  FaClipboard,
  FaClipboardCheck,
  FaClipboardList,
  FaClock,
  FaClone,
  FaClosedCaptioning,
  FaCloudDownloadAlt,
  FaCloudMeatball,
  FaCloudUploadAlt,
  FaCocktail,
  FaCoins,
  FaColumns,
  FaComment,
  FaCommentAlt,
  FaCommentDots,
  FaComments,
  FaCompactDisc,
  FaCompass,
  FaCompress,
  FaCompressAlt,
  FaCompressArrowsAlt,
  FaConciergeBell,
  FaCookie,
  FaCookieBite,
  FaCopy,
  FaCopyright,
  FaCreditCard,
  FaCrop,
  FaCross,
  FaCrown,
  FaCube,
  FaCut,
  FaDeaf,
  FaDemocrat,
  FaDharmachakra,
  FaDiagnoses,
  FaDiceD20,
  FaDiceD6,
  FaDigitalTachograph,
  FaDirections,
  FaDivide,
  FaDizzy,
  FaDonate,
  FaDoorClosed,
  FaDoorOpen,
  FaDotCircle,
  FaDove,
  FaDraftingCompass,
  FaDragon,
  FaDrawPolygon,
  FaDrum,
  FaDrumSteelpan,
  FaDumbbell,
  FaDumpster,
  FaDumpsterFire,
  FaDungeon,
  FaRedo,
  FaCode,
  FaHandPointer,
  FaIdBadge,
  FaLightbulb,
  FaDice,
  FaShareAlt,
  FaShareSquare,
  FaBroom,
  FaFeather,
  FaChevronDown,
  FaChevronUp,
  FaChevronLeft,
  FaChevronRight,
  FaCodeBranch,
  FaDownload,
  FaUpload,
  FaTablet,
  FaMobileAlt
} from 'react-icons/fa';
import { FaAnchorCircleCheck } from "react-icons/fa6";

const allIcons: string[] = [
  "FaBeer",
  "FaApple",
  "FaAnchor",
  "FaCoffee",
  "FaCar",
  "FaCat",
  "FaDog",
  "FaHome",
  "FaSearch",
  "FaInfoCircle",
  "FaPlane",
  "FaRocket",
  "FaStar",
  "FaTrashAlt",
  "FaUser",
  "FaBell",
  "FaCloud",
  "FaCogs",
  "FaBriefcase",
  "FaCamera",
  "FaClock",
  "FaDesktop",
  "FaEdit",
  "FaHeart",
  "FaMapMarker",
  "FaPhone",
  "FaShoppingCart",
  "FaTv",
  "FaVolumeUp",
  "FaWifi",
  "FaBicycle",
  "FaGlobe",
  "FaLaptop",
  "FaUserAlt",
  "FaSignInAlt",
  "FaSignOutAlt",
  "FaLayerGroup",
  "FaLink",
  "FaArrowAltCircleDown",
  "FaArrowAltCircleUp",
  "FaChevronCircleRight",
  "FaChevronCircleLeft",
  "FaDollarSign",
  "FaEject",
  "FaGift",
  "FaFlag",
  "FaGlasses",
  "FaHandPaper",
  "FaHeadphones",
  "FaHdd",
  "FaMusic",
  "FaPowerOff",
  "FaPhoneAlt",
  "FaPlug",
  "FaSatellite",
  "FaShieldAlt",
  "FaStop",
  "FaSync",
  "FaTachometerAlt",
  "FaTrash",
  "FaTree",
  "FaUserPlus",
  "FaUserCheck",
  "FaWrench",
  "FaTruck",
  "FaKey",
  "FaChartLine",
  "FaHammer",
  "FaPlayCircle",
  "FaCog",
  "FaCrosshairs",
  "FaMap",
  "FaDatabase",
  "FaLock",
  "FaUnlock",
  "FaUndo",
  "FaRedo",
  "FaCode",
  "FaHandPointer",
  "FaIdBadge",
  "FaLightbulb",
  "FaDice",
  "FaShareAlt",
  "FaShareSquare",
  "FaBroom",
  "FaFeather",
  "FaChevronDown",
  "FaChevronUp",
  "FaChevronLeft",
  "FaChevronRight",
  "FaCodeBranch",
  "FaDownload",
  "FaUpload",
  "FaTablet",
  "FaMobileAlt",
  "FaAdjust",
  "FaAlignCenter",
  "FaAlignJustify",
  "FaAlignLeft",
  "FaAlignRight",
  "FaAllergies",
  "FaAmbulance",
  "FaAnchorCircleCheck",
  "FaAngleDoubleDown",
  "FaAngleDoubleLeft",
  "FaAngleDoubleRight",
  "FaAngleDoubleUp",
  "FaAngleDown",
  "FaAngleLeft",
  "FaAngleRight",
  "FaAngleUp",
  "FaAngry",
  "FaAppleAlt",
  "FaArchive",
  "FaArchway",
  "FaArrowCircleDown",
  "FaArrowCircleLeft",
  "FaArrowCircleRight",
  "FaArrowCircleUp",
  "FaArrowDown",
  "FaArrowLeft",
  "FaArrowRight",
  "FaArrowUp",
  "FaArrowsAlt",
  "FaArrowsAltH",
  "FaArrowsAltV",
  "FaAssistiveListeningSystems",
  "FaAsterisk",
  "FaAt",
  "FaAtom",
  "FaAudioDescription",
  "FaBackspace",
  "FaBackward",
  "FaBan",
  "FaBandAid",
  "FaBarcode",
  "FaBars",
  "FaBaseballBall",
  "FaBasketballBall",
  "FaBath",
  "FaBatteryEmpty",
  "FaBatteryFull",
  "FaBatteryHalf",
  "FaBatteryQuarter",
  "FaBatteryThreeQuarters",
  "FaBed",
  "FaBinoculars",
  "FaBirthdayCake",
  "FaBlender",
  "FaBold",
  "FaBolt",
  "FaBomb",
  "FaBook",
  "FaBookmark",
  "FaBowlingBall",
  "FaBox",
  "FaBoxOpen",
  "FaBoxes",
  "FaBraille",
  "FaBroadcastTower",
  "FaBrush",
  "FaBug",
  "FaBuilding",
  "FaBullhorn",
  "FaBullseye",
  "FaBurn",
  "FaBus",
  "FaBusinessTime",
  "FaCalculator",
  "FaCalendar",
  "FaCalendarAlt",
  "FaCalendarCheck",
  "FaCalendarDay",
  "FaCalendarMinus",
  "FaCalendarPlus",
  "FaCalendarTimes",
  "FaCameraRetro",
  "FaCampground",
  "FaCarAlt",
  "FaCaretDown",
  "FaCaretLeft",
  "FaCaretRight",
  "FaCaretSquareDown",
  "FaCaretSquareLeft",
  "FaCaretSquareRight",
  "FaCaretSquareUp",
  "FaCaretUp",
  "FaCartArrowDown",
  "FaCartPlus",
  "FaCertificate",
  "FaChair",
  "FaChalkboard",
  "FaChalkboardTeacher",
  "FaChargingStation",
  "FaCheck",
  "FaCheckCircle",
  "FaCheckSquare",
  "FaChevronCircleDown",
  "FaChevronCircleUp",
  "FaChild",
  "FaChurch",
  "FaCircle",
  "FaCircleNotch",
  "FaCity",
  "FaClinicMedical",
  "FaClipboard",
  "FaClipboardCheck",
  "FaClipboardList",
  "FaClone",
  "FaClosedCaptioning",
  "FaCloudDownloadAlt",
  "FaCloudMeatball",
  "FaCloudUploadAlt",
  "FaCocktail",
  "FaCoins",
  "FaColumns",
  "FaComment",
  "FaCommentAlt",
  "FaCommentDots",
  "FaComments",
  "FaCompactDisc",
  "FaCompass",
  "FaCompress",
  "FaCompressAlt",
  "FaCompressArrowsAlt",
  "FaConciergeBell",
  "FaCookie",
  "FaCookieBite",
  "FaCopy",
  "FaCopyright",
  "FaCreditCard",
  "FaCrop",
  "FaCross",
  "FaCrown",
  "FaCube",
  "FaCut",
  "FaDeaf",
  "FaDemocrat",
  "FaDharmachakra",
  "FaDiagnoses",
  "FaDiceD20",
  "FaDiceD6",
  "FaDigitalTachograph",
  "FaDirections",
  "FaDivide",
  "FaDizzy",
  "FaDonate",
  "FaDoorClosed",
  "FaDoorOpen",
  "FaDotCircle",
  "FaDove",
  "FaDraftingCompass",
  "FaDragon",
  "FaDrawPolygon",
  "FaDrum",
  "FaDrumSteelpan",
  "FaDumbbell",
  "FaDumpster",
  "FaDumpsterFire",
  "FaDungeon"
];

// Create a map to associate icon names with components
const iconMap = {
  FaBeer,
  FaApple,
  FaAnchor,
  FaCoffee,
  FaCar,
  FaCat,
  FaDog,
  FaHome,
  FaSearch,
  FaInfoCircle,
  FaPlane,
  FaRocket,
  FaStar,
  FaTrashAlt,
  FaUser,
  FaBell,
  FaCloud,
  FaCogs,
  FaBriefcase,
  FaCamera,
  FaClock,
  FaDesktop,
  FaEdit,
  FaHeart,
  FaMapMarker,
  FaPhone,
  FaShoppingCart,
  FaTv,
  FaVolumeUp,
  FaWifi,
  FaBicycle,
  FaGlobe,
  FaLaptop,
  FaUserAlt,
  FaSignInAlt,
  FaSignOutAlt,
  FaLayerGroup,
  FaLink,
  FaArrowAltCircleDown,
  FaArrowAltCircleUp,
  FaChevronCircleRight,
  FaChevronCircleLeft,
  FaDollarSign,
  FaEject,
  FaGift,
  FaFlag,
  FaGlasses,
  FaHandPaper,
  FaHeadphones,
  FaHdd,
  FaMusic,
  FaPowerOff,
  FaPhoneAlt,
  FaPlug,
  FaSatellite,
  FaShieldAlt,
  FaStop,
  FaSync,
  FaTachometerAlt,
  FaTrash,
  FaTree,
  FaUserPlus,
  FaUserCheck,
  FaWrench,
  FaTruck,
  FaKey,
  FaChartLine,
  FaHammer,
  FaPlayCircle,
  FaCog,
  FaCrosshairs,
  FaMap,
  FaDatabase,
  FaLock,
  FaUnlock,
  FaUndo,
  FaRedo,
  FaCode,
  FaHandPointer,
  FaIdBadge,
  FaLightbulb,
  FaDice,
  FaShareAlt,
  FaShareSquare,
  FaBroom,
  FaFeather,
  FaChevronDown,
  FaChevronUp,
  FaChevronLeft,
  FaChevronRight,
  FaCodeBranch,
  FaDownload,
  FaUpload,
  FaTablet,
  FaMobileAlt,
  FaAdjust,
  FaAlignCenter,
  FaAlignJustify,
  FaAlignLeft,
  FaAlignRight,
  FaAllergies,
  FaAmbulance,
  FaAnchorCircleCheck,
  FaAngleDoubleDown,
  FaAngleDoubleLeft,
  FaAngleDoubleRight,
  FaAngleDoubleUp,
  FaAngleDown,
  FaAngleLeft,
  FaAngleRight,
  FaAngleUp,
  FaAngry,
  FaAppleAlt,
  FaArchive,
  FaArchway,
  FaArrowCircleDown,
  FaArrowCircleLeft,
  FaArrowCircleRight,
  FaArrowCircleUp,
  FaArrowDown,
  FaArrowLeft,
  FaArrowRight,
  FaArrowUp,
  FaArrowsAlt,
  FaArrowsAltH,
  FaArrowsAltV,
  FaAssistiveListeningSystems,
  FaAsterisk,
  FaAt,
  FaAtom,
  FaAudioDescription,
  FaBackspace,
  FaBackward,
  FaBan,
  FaBandAid,
  FaBarcode,
  FaBars,
  FaBaseballBall,
  FaBasketballBall,
  FaBath,
  FaBatteryEmpty,
  FaBatteryFull,
  FaBatteryHalf,
  FaBatteryQuarter,
  FaBatteryThreeQuarters,
  FaBed,
  FaBinoculars,
  FaBirthdayCake,
  FaBlender,
  FaBold,
  FaBolt,
  FaBomb,
  FaBook,
  FaBookmark,
  FaBowlingBall,
  FaBox,
  FaBoxOpen,
  FaBoxes,
  FaBraille,
  FaBroadcastTower,
  FaBrush,
  FaBug,
  FaBuilding,
  FaBullhorn,
  FaBullseye,
  FaBurn,
  FaBus,
  FaBusinessTime,
  FaCalculator,
  FaCalendar,
  FaCalendarAlt,
  FaCalendarCheck,
  FaCalendarDay,
  FaCalendarMinus,
  FaCalendarPlus,
  FaCalendarTimes,
  FaCameraRetro,
  FaCampground,
  FaCarAlt,
  FaCaretDown,
  FaCaretLeft,
  FaCaretRight,
  FaCaretSquareDown,
  FaCaretSquareLeft,
  FaCaretSquareRight,
  FaCaretSquareUp,
  FaCaretUp,
  FaCartArrowDown,
  FaCartPlus,
  FaCertificate,
  FaChair,
  FaChalkboard,
  FaChalkboardTeacher,
  FaChargingStation,
  FaCheck,
  FaCheckCircle,
  FaCheckSquare,
  FaChevronCircleDown,
  FaChevronCircleUp,
  FaChild,
  FaChurch,
  FaCircle,
  FaCircleNotch,
  FaCity,
  FaClinicMedical,
  FaClipboard,
  FaClipboardCheck,
  FaClipboardList,
  FaClone,
  FaClosedCaptioning,
  FaCloudDownloadAlt,
  FaCloudMeatball,
  FaCloudUploadAlt,
  FaCocktail,
  FaCoins,
  FaColumns,
  FaComment,
  FaCommentAlt,
  FaCommentDots,
  FaComments,
  FaCompactDisc,
  FaCompass,
  FaCompress,
  FaCompressAlt,
  FaCompressArrowsAlt,
  FaConciergeBell,
  FaCookie,
  FaCookieBite,
  FaCopy,
  FaCopyright,
  FaCreditCard,
  FaCrop,
  FaCross,
  FaCrown,
  FaCube,
  FaCut,
  FaDeaf,
  FaDemocrat,
  FaDharmachakra,
  FaDiagnoses,
  FaDiceD20,
  FaDiceD6,
  FaDigitalTachograph,
  FaDirections,
  FaDivide,
  FaDizzy,
  FaDonate,
  FaDoorClosed,
  FaDoorOpen,
  FaDotCircle,
  FaDove,
  FaDraftingCompass,
  FaDragon,
  FaDrawPolygon,
  FaDrum,
  FaDrumSteelpan,
  FaDumbbell,
  FaDumpster,
  FaDumpsterFire,
  FaDungeon,
};

interface IconPickerProps {
  activeIcon: string;
  setActiveIcon: (iconName: string) => void;
  defaultLoadedIcons?: number;
}

const IconPicker: React.FC<IconPickerProps> = ({ activeIcon, setActiveIcon, defaultLoadedIcons = 15 }) => {
  const [filteredIcons, setFilteredIcons] = useState<string[]>(allIcons.slice(0, defaultLoadedIcons));
  const [searchQuery, setSearchQuery] = useState('');
  const [loadedIcons, setLoadedIcons] = useState<number>(defaultLoadedIcons);
  const inputRef = useRef<HTMLInputElement>(null);
  const listRef = useRef<HTMLDivElement>(null); // Add reference to the list container

  // Handle Search Input
  const handleSearch = (e: React.ChangeEvent<HTMLInputElement>) => {
    setSearchQuery(e.target.value);
    const filtered = allIcons.filter(icon => icon.toLowerCase().includes(e.target.value.toLowerCase()));
    setFilteredIcons(filtered.slice(0, defaultLoadedIcons)); // Reset to 15 icons when searching
    setLoadedIcons(defaultLoadedIcons);
  };

  // Load More Icons on Scroll
  const handleScroll = (e: React.UIEvent<HTMLDivElement>) => {
    const target = e.target as HTMLDivElement;
    const nearBottom = target.scrollTop + target.clientHeight >= target.scrollHeight - 10; // 10px before reaching the bottom

    if (nearBottom && loadedIcons <= filteredIcons.length) {
      setLoadedIcons(prev => prev + 15);
    }
  };

  useEffect(() => {
    const filtered = searchQuery ? allIcons.filter(icon => icon.toLowerCase().includes(searchQuery.toLowerCase())) : allIcons;
    setFilteredIcons(filtered.slice(0, loadedIcons));
  }, [loadedIcons, searchQuery]);

  return (
    <form className="icon-picker w-full max-w-xl p-4 bg-zinc-900 text-white border border-zinc-700 rounded-lg shadow-lg">
      <input
        ref={inputRef}
        type="text"
        placeholder="Search icons..."
        value={searchQuery}
        autoComplete="off"
        onChange={handleSearch}
        className="w-full py-2 px-4 mb-4 border border-zinc-600 bg-zinc-800 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
      />
      <div
        ref={listRef} // Attach ref to the scrollable container
        className="icon-list grid grid-cols-6 gap-4 overflow-y-auto overflow-x-hidden no-scrollbar max-h-72 scrollbar-thin scrollbar-thumb-zinc-600 scrollbar-track-zinc-800"
        onScroll={handleScroll}
      >
        {filteredIcons.slice(0, loadedIcons).map((iconName, index) => {
          const IconComponent = iconMap[iconName as keyof typeof iconMap]; // Get the icon component from the map
          const isActive = iconName === activeIcon;
          return (
            <button
              key={index}
              className={`icon-item rounded-full text-center cursor-pointer p-2 transition duration-150 ease-in-out ${isActive ? 'bg-zinc-700/80' : 'hover:bg-zinc-800/80'}`}
              onClick={(e) => { e.preventDefault(); setActiveIcon(iconName) }}
            >
              <div className={`icon flex items-center py-1.5 justify-center text-xl ${isActive ? '!text-white' : 'text-zinc-400 hover:!text-white'}`}>
                <IconComponent />
              </div>
            </button>
          );
        })}

        {/* Invisible div to trigger scroll event */}
        <div className="w-full flex items-center justify-center" style={{ height: `${loadedIcons < filteredIcons.length ? 32 : 0}px` }}>
          {/* <Loader2 className="animate-spin text-sm" /> */}
        </div>
      </div>
    </form>
  );
};

export default IconPicker;
